[
  {
    "objectID": "intro_mixed.html",
    "href": "intro_mixed.html",
    "title": "Mixed Models Analysis Using Large Datasets",
    "section": "",
    "text": "This project is designed to guide you through the process of performing a mixed-effects model using large data sets in R. Mixed models‚Äîalso known as hierarchical, multilevel, or random-effects models‚Äîare statistical approaches that allow us to account for both fixed effects (systematic, population-level factors) and random effects (group- or subject-level variability).\nThese models are particularly powerful when dealing with grouped, clustered, or repeated-measures data, such as individuals measured multiple times, schools within regions, or experiments conducted across sites. By explicitly modelling the correlation structure within the data, mixed models yield more accurate estimates and generalisable inferences.\nThe tutorial is structured into a series of sections introducing you to the basic concepts, analytic approaches, and applications of mixed models in R. You will learn how to structure your data, fit models, interpret both fixed and random effects, and visualise and validate results.\n\n\n\n\n\n\n\n\n\n\nStage\nFocus\nR packages\n\n\n\n\n1. Data Curation\nImporting, cleaning, and structuring grouped data\ntidyverse\n\n\n2. Exploratory Analysis\nExploring distributions and grouping effects\nggplot2, dplyr\n\n\n3. Model Fitting\nBuilding linear mixed-effects models\nlme4, lmerTest\n\n\n4. Diagnostics\nChecking assumptions and model stability\nperformance\n\n\n5. Visualisation\nPlotting fixed/random effects\nsjPlot, ggeffects\n\n\n6. Interpretation\nPresenting your findings\nggplot , forest plots\n\n\n7.Extensions\nGeneralised or hierarchical structures\nglmmTMB, brms\n\n\n\n\n\n\n\nIn this ReCoDe project we will be using R so it would be very useful to take some courses offered by the Graduate School at Imperial College London, either as an introduction or a refresher:\nResearch Computing & Data Science Skills Courses\n\nData Exploration and Visualisation\nIntroduction to R\nData Processing with R"
  },
  {
    "objectID": "intro_mixed.html#welcome-to-the-random-side-of-r-a-mixed-model-adventure-recode-project",
    "href": "intro_mixed.html#welcome-to-the-random-side-of-r-a-mixed-model-adventure-recode-project",
    "title": "Mixed Models Analysis Using Large Datasets",
    "section": "",
    "text": "This project is designed to guide you through the process of performing a mixed-effects model using large data sets in R. Mixed models‚Äîalso known as hierarchical, multilevel, or random-effects models‚Äîare statistical approaches that allow us to account for both fixed effects (systematic, population-level factors) and random effects (group- or subject-level variability).\nThese models are particularly powerful when dealing with grouped, clustered, or repeated-measures data, such as individuals measured multiple times, schools within regions, or experiments conducted across sites. By explicitly modelling the correlation structure within the data, mixed models yield more accurate estimates and generalisable inferences.\nThe tutorial is structured into a series of sections introducing you to the basic concepts, analytic approaches, and applications of mixed models in R. You will learn how to structure your data, fit models, interpret both fixed and random effects, and visualise and validate results.\n\n\n\n\n\n\n\n\n\n\nStage\nFocus\nR packages\n\n\n\n\n1. Data Curation\nImporting, cleaning, and structuring grouped data\ntidyverse\n\n\n2. Exploratory Analysis\nExploring distributions and grouping effects\nggplot2, dplyr\n\n\n3. Model Fitting\nBuilding linear mixed-effects models\nlme4, lmerTest\n\n\n4. Diagnostics\nChecking assumptions and model stability\nperformance\n\n\n5. Visualisation\nPlotting fixed/random effects\nsjPlot, ggeffects\n\n\n6. Interpretation\nPresenting your findings\nggplot , forest plots\n\n\n7.Extensions\nGeneralised or hierarchical structures\nglmmTMB, brms"
  },
  {
    "objectID": "intro_mixed.html#pre-requisites",
    "href": "intro_mixed.html#pre-requisites",
    "title": "Mixed Models Analysis Using Large Datasets",
    "section": "",
    "text": "In this ReCoDe project we will be using R so it would be very useful to take some courses offered by the Graduate School at Imperial College London, either as an introduction or a refresher:\nResearch Computing & Data Science Skills Courses\n\nData Exploration and Visualisation\nIntroduction to R\nData Processing with R"
  },
  {
    "objectID": "intro_mixed.html#introductory-lecture-on-mixed-models",
    "href": "intro_mixed.html#introductory-lecture-on-mixed-models",
    "title": "Mixed Models Analysis Using Large Datasets",
    "section": "Introductory lecture on mixed models",
    "text": "Introductory lecture on mixed models\n\n\nOther resources\n\nMixed models in epidemiology\nMixed models in psychology\nMixed models in ecology\nMixed models in finance"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "",
    "text": "This exemplar was developed at Imperial College London by Valentina Quintero Santofimio in collaboration with Saranjeet Kaur Bhogal and Miruna Serian from Research Software Engineering and John Pinney from Research Computing & Data Science at the Early Career Researcher Institute."
  },
  {
    "objectID": "index.html#brief-description",
    "href": "index.html#brief-description",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Brief description",
    "text": "Brief description\nMixed models, also known multilevel/hierarchical models, are a type of statistical model that include fixed effects and/or random effects. Traditional linear models assume all observations are independent, but that‚Äôs rarely true. For example, patients from the same hospital, students from the same classroom, or multiple measurements from the same individual, have a specific structure that if ignored, it can lead to biased estimates, underestimated variability, and invalid conclusions. In this project, I plan to offer a practical introduction to mixed effects models in R, focusing on their use for analysing data with grouped/hierarchical structures. I will cover when and why to use mixed models, explain the difference between fixed and random effects, and walk through examples using specific R packages"
  },
  {
    "objectID": "index.html#learning-outcomes",
    "href": "index.html#learning-outcomes",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Learning Outcomes üéì",
    "text": "Learning Outcomes üéì\nAfter completing this exemplar, students will:\n\nUnderstand the foundation of linear mixed-effects models (LMMs)\nKnow when and why to use mixed models over simple linear regression\nImplement mixed models in R\nInterpret fixed and random effects, variance components, and model fit statistics\nVisualize and validate model\nExtend to generalized mixed models (GLMMs) and crossed/nested designs"
  },
  {
    "objectID": "index.html#target-audience",
    "href": "index.html#target-audience",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Target Audience üéØ",
    "text": "Target Audience üéØ\nThe primary focus is to work with large (usually epidemiological) data. Mixed models are useful when working with repeated measures, nested data, or simply when we want to account for variability across groups.\nThese models however, can be applicable to any large dataset (any discipline), that has sufficient grouping or hierarchical structure, ensuring accurate interpretation and conclusions."
  },
  {
    "objectID": "index.html#requirements",
    "href": "index.html#requirements",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Requirements",
    "text": "Requirements"
  },
  {
    "objectID": "index.html#academic",
    "href": "index.html#academic",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Academic üìö",
    "text": "Academic üìö\nIt would be very useful to take some courses offered by the Graduate School at Imperial College London, either as an introduction or a refresher:\nResearch Computing & Data Science Skills Courses\n\nData Exploration and Visualisation\nIntroduction to R\nData Processing with R"
  },
  {
    "objectID": "index.html#software-tools",
    "href": "index.html#software-tools",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Software Tools üõ†Ô∏è",
    "text": "Software Tools üõ†Ô∏è\nIn this project we will be using R and RStudio:\nR (the statistical programming language): 4.5.1. RStudio (the IDE/GUI for R): 2025.09.2\nWe will also use the following R packages: - lme4 for fitting the model - lmerTest for advanced models - performance, see, and parameters for diagnostics, fit checks, and parameter extraction"
  },
  {
    "objectID": "index.html#getting-started",
    "href": "index.html#getting-started",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Getting Started üöÄ",
    "text": "Getting Started üöÄ\n\nStart by reading the ReCoDE main page.\nComplete the Introduction section (video lecture, reading materials)\nContinue with Data Curation(get your data ready for a mixed model analysis)\nConduct a Mixed model analysis I\nTake your analysis to the next level by attempting the extension task Mixed model analysis II (Advanced exercise)"
  },
  {
    "objectID": "index.html#roadmap",
    "href": "index.html#roadmap",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Roadmap üó∫Ô∏è",
    "text": "Roadmap üó∫Ô∏è\n\nCore üß©\n\nUnderstanding mixed models\n\nCorrect type of data\n\nOrganise your data\n\nWith worked example\n\nBasic visualisation\n\nMini-project: ‚ÄúVisualise your groups‚Äù\n\nData Analysis\n\nWhat R packages should I use?\nRun different mixed models\n\nResults\n\nUnderstanding my results\nVisualisating results\nIs my model good enough?\n\n\n\n\nExtensions üîå\n\nAdvanced mixed-models\n\nUsing complex data"
  },
  {
    "objectID": "index.html#data",
    "href": "index.html#data",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Data üìä",
    "text": "Data üìä\nFor this exercise, a synthetic data set will be generated resembling large epidemiological data with different sites (clusters)."
  },
  {
    "objectID": "index.html#estimated-time",
    "href": "index.html#estimated-time",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Estimated Time ‚è≥",
    "text": "Estimated Time ‚è≥\n\n\n\nTask\nTime\n\n\n\n\nPre-session material\n3 hours\n\n\nData curation\n2 hours\n\n\nAnalysis\n2-3 hours\n\n\nInterpretation of results\n2 hours"
  },
  {
    "objectID": "index.html#licence",
    "href": "index.html#licence",
    "title": "The Random Side of R: A Mixed Model Adventure",
    "section": "Licence üìÑ",
    "text": "Licence üìÑ\nThis project is licensed under the BSD-3-Clause license."
  },
  {
    "objectID": "LICENSE.html",
    "href": "LICENSE.html",
    "title": "ReCoDE: Mixed models R tutorial",
    "section": "",
    "text": "BSD 3-Clause License\nCopyright (c) 2022-2025, Imperial College London All rights reserved.\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n\nRedistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\nRedistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\nNeither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS ‚ÄúAS IS‚Äù AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE."
  },
  {
    "objectID": "curation.html",
    "href": "curation.html",
    "title": "Data Curation",
    "section": "",
    "text": "It is very important to have your data ready and in the right format before you run any models. This section of the tutorial will allow you practice cleaning the data set."
  },
  {
    "objectID": "curation.html#about-the-dataset",
    "href": "curation.html#about-the-dataset",
    "title": "Data Curation",
    "section": "About the dataset",
    "text": "About the dataset\nThe dataset contains simulated data for 2,000 adults from eight study sites (UK, USA, Colombia, India, South Africa, Poland, Vietnam, and Australia). It was generated to illustrate mixed-effects modeling and data cleaning workflows in respiratory epidemiology. Each participant has demographic, occupational, and lung function information designed to reflect a realistic example.\n\nüßπ Let‚Äôs Get Cleaning!\nBefore jumping into mixed-modelling, we need to tackle some messy data. The dirty dataset (mixed_dirty.txt) mirrors the kind of inconsistencies found in real epidemiological studies, including: typos, missing entries, odd units, and empty spaces.\n\n\n\n\n\n\n\nVariable\nDescription\n\n\n\n\nid\nUnique participant identifier (1‚Äì2000)\n\n\nsite\nStudy site (country: UK, USA, Colombia, India, South Africa, Poland, Vietnam, or Australia)\n\n\nage\nParticipant age in years (contains missing values)\n\n\nsex\nRecorded sex (e.g., ‚ÄúM‚Äù, ‚ÄúF‚Äù, ‚Äúmale‚Äù, ‚ÄúFemale‚Äù, ‚Äúf‚Äù, ‚Äúm‚Äù, ‚Äúother‚Äù)\n\n\nheight_cm\nHeight in centimetres (may include blanks, ‚ÄúNA‚Äù, or blank spaces)\n\n\nweight_kg\nWeight in kilograms (some missing or inconsistent entries)\n\n\nBMI\nBody mass index derived from height and weight; includes rounding errors and missing values\n\n\nsmoking_status\nSelf-reported smoking behaviour with inconsistent text (e.g., ‚ÄúNever‚Äù, ‚Äúnever‚Äù, ‚ÄúCURRENT‚Äù, ‚Äúex‚Äù, ‚Äúquit&gt;1y‚Äù, ‚ÄúUnknown‚Äù)\n\n\npack_years\nApproximate pack-years of smoking exposure (some missing or inconsistent with smoking status)\n\n\neducation\nEducational attainment (free-text responses such as ‚Äúprimary‚Äù, ‚Äúsec‚Äù, ‚ÄúCollege‚Äù, ‚Äúuni‚Äù, or blanks)\n\n\njob\nReported occupation, intentionally messy (e.g., ‚Äúnuse‚Äù, ‚Äúmining‚Äù, ‚Äúconstructor‚Äù, ‚Äúteacher‚Äù, ‚Äúoffice‚Äù)\n\n\nexposure_cat\nOccupational exposure category (‚Äúlow‚Äù or ‚Äúhigh_exposure‚Äù) with inconsistent naming\n\n\nFEV1_mL\nForced Expiratory Volume in 1 second, in millilitres; includes outliers, missing values, and some negative entries\n\n\nFVC_mL\nForced Vital Capacity, in millilitres; includes missing values\n\n\n\n\nNote: The mixed_dirty.txt dataset includes deliberate inconsistencies and data quality issues for you to identify and correct during cleaning exercises (e.g., converting FEV1/FVC to litres, standardise categorical variables, and deriving exposure categories).\n\nYour task is to explore, clean, and prepare it for analysis."
  },
  {
    "objectID": "curation.html#install-relevant-packages-and-load-your-data",
    "href": "curation.html#install-relevant-packages-and-load-your-data",
    "title": "Data Curation",
    "section": "Install relevant packages and load your data",
    "text": "Install relevant packages and load your data\nFor this chapter we will need the following R packages: - tidyverse - stringr - dplyr\n\nNote: Only install these if you have not already, otherwise go straight to library()"
  },
  {
    "objectID": "curation.html#load-your-data",
    "href": "curation.html#load-your-data",
    "title": "Data Curation",
    "section": "Load your data",
    "text": "Load your data\n\ndirty &lt;- read.table(\"data/mixed_dirty.txt\", sep = \"\\t\", header=T)\n\n#Inspect first few rows\nhead(dirty)\n\n  id    site age    sex height_cm weight_kg  BMI   smoking_status pack_years\n1  1      UK  77   male     181.5      97.9 29.7       Occasional       11.0\n2  2 Vietnam  22      m     157.2      62.6 25.3          CURRENT       15.2\n3  3  Poland  45      M     146.3      48.3 22.6                         0.0\n4  4   India  49 Female     149.1      62.2 28.0          current        6.7\n5  5   India  72      m     177.8      67.7 21.4          quit&lt;1y        0.0\n6  6 Vietnam  26  other     160.4      78.8 30.6 Smokes socially         6.9\n  education       job  exposure_cat FEV1_mL FVC_mL\n1  tertiary bartender           LOW    3469   4918\n2       BSc    porter           LOW    4360   5107\n3   primary   factory high_exposure    3154   4898\n4 Secondary   factory high_exposure    1876   3283\n5           security            hi     3002   5338\n6   College    doctor           low    3010   3888\n\n\n\n1. Fixing white spaces and NAs\nIt is common to encounter missing spaces in our data, but it is important to ensure that this is fixed before we start analysing our data. The str_squish() function trims these and replaces multiple spaces with a single one, this is an important first step before matching or grouping text variables (e.g., ‚Äúnurse‚Äù vs ‚Äúnurse‚Äù).\n\ncleaning &lt;- dirty %&gt;%\n  mutate(across(where(is.character), ~str_squish(.x)))\n\n\n\n2. Convert numeric columns correctly\nSometimes numbers are stored as text (for example, ‚Äú170‚Äù or ‚ÄúNA‚Äù as a string). We need to make sure we convert those variables to numeric format.\n\ncleaning &lt;- cleaning %&gt;%\n  mutate(across(c(age, height_cm, weight_kg, BMI, pack_years, FEV1_mL, FVC_mL),\n                ~suppressWarnings(as.numeric(.x))))\n\n\n\n3. Standardise categorical variables\nCategorical variables often contain many variations of the same label (e.g., ‚Äúfemale‚Äù, ‚ÄúFEMALE‚Äù, or ‚ÄúF‚Äù). Here, we make them consistent using case_when(). The same logic applies to similar variables such as smoking status and education. Standardising is a very important step that ensures data is grouped correctly.\n\ncleaning &lt;- cleaning %&gt;%\n  mutate(\n    sex_clean = case_when(\n      str_starts(tolower(sex), \"m\") ~ \"Male\",\n      str_starts(tolower(sex), \"f\") ~ \"Female\",\n      TRUE ~ \"Other\"\n    ),\n    smoking_status_clean = case_when(\n      is.na(smoking_status) | smoking_status %in% c(\"\", \"NA\", \"Unknown\", \"unknown\") ~ NA_character_,\n      str_starts(tolower(smoking_status), \"never\") ~ \"Never\",\n      str_detect(tolower(smoking_status), \"current|smokes socially\") & \n        !str_detect(tolower(smoking_status), \"quit\") ~ \"Current\",\n      str_detect(tolower(smoking_status), \"former|ex|quit\") ~ \"Former\",\n      tolower(smoking_status) == \"occasional\" ~ \"Current\",\n      TRUE ~ NA_character_\n    ),\n    education_clean = case_when(\n      is.na(education) | education %in% c(\"\", \"NA\", \"na\", \"none\", \"None\") ~ \"None\",\n      tolower(education) %in% c(\"primary\") ~ \"Primary\",\n      tolower(education) %in% c(\"secondary\",\"sec\",\"high school\") ~ \"Secondary\",\n      tolower(education) %in% c(\"college\",\"uni\",\"tertiary\",\"masters\",\"phd\",\"bsc\") ~ \"Tertiary\",\n      TRUE ~ \"None\"\n    )\n  )\n\n\n\n4. Clean job names (for this ReCoDe example)\nIn epidemiology studies, we often collect self-reported data like occupational data for our research questions. But coding job titles can be messy, (if not using standardised tools) resulting in misspellings (‚Äúnuse‚Äù), inconsistent forms (‚Äúmining‚Äù vs ‚Äúminer‚Äù), or abbreviations. By converting everything to lowercase first and then mapping known variants to standard labels, we make sure occupations are consistent and ready to categorise later (e.g., into exposure groups).\n\ncleaning &lt;- cleaning %&gt;%\n  mutate(\n    job_lc = tolower(job),\n    job_clean = case_when(\n      job_lc %in% c(\"nuse\",\"nurse\") ~ \"nurse\",\n      job_lc %in% c(\"miner\",\"mining\") ~ \"miner\",\n      job_lc %in% c(\"constructor\",\"construction\") ~ \"construction worker\",\n      job_lc == \"office\" ~ \"office worker\",\n      job_lc == \"teacher\" ~ \"teacher\",\n      job_lc == \"farmer\" ~ \"farmer\",\n      job_lc == \"driver\" ~ \"driver\",\n      job_lc == \"welder\" ~ \"welder\",\n      job_lc == \"factory\" ~ \"factory worker\",\n      job_lc == \"carpenter\" ~ \"carpenter\",\n      job_lc == \"doctor\" ~ \"doctor\",\n      job_lc == \"security\" ~ \"security\",\n      job_lc == \"cleaner\" ~ \"cleaner\",\n      job_lc == \"mechanic\" ~ \"mechanic\",\n      job_lc == \"electrician\" ~ \"electrician\",\n      job_lc == \"bartender\" ~ \"bartender\",\n      job_lc == \"porter\" ~ \"porter\",\n      TRUE ~ job_lc\n    )\n  )\n\n\n\n5. Create a new variable\nIt is very common to derive and create new variables when using large datasets. In this example, we classify jobs into high exposure or low exposure categories based on potential for dust, fumes, or other respiratory hazards. This step prepares the dataset for later regression or mixed-model analyses exploring exposure‚Äìlung function relationships.\n\ncleaning &lt;- cleaning %&gt;%\n  mutate(\n    exposure_cat_clean = case_when(\n      job_clean %in% c(\"miner\",\"welder\",\"factory worker\",\"carpenter\",\"mechanic\",\"electrician\") ~ \"high_exposure\",\n      job_clean %in% c(\"office worker\",\"teacher\",\"doctor\",\"nurse\",\"construction worker\", \"security\",\"cleaner\",\"bartender\",\"porter\",\"farmer\",\"driver\") ~ \"low_exposure\",\n      TRUE ~ \"low_exposure\"\n    )\n  )\n\n\n\n6. Convert FEV1 and FVC to litres and calculate ratio\nFEV1 and FVC are recorded in millilitres in the raw data, so we convert them to litres for analysis. The FEV1/FVC ratio is a key lung function indicator and values below normal suggest obstruction. During collection of this data some errors may have occurred, so it is important we remove any outliers at this stage that could bias our analyses later on.\n\ncleaning &lt;- cleaning %&gt;%\n  mutate(\n    FEV1_L = FEV1_mL / 1000,\n    FVC_L  = FVC_mL / 1000,\n    FEV1_FVC = FEV1_L / FVC_L\n  ) %&gt;%\n  mutate(\n    FEV1_L = if_else(!is.na(FEV1_L) & FEV1_L &lt;= 0, NA_real_, FEV1_L),\n    FVC_L  = if_else(!is.na(FVC_L) & FVC_L &lt;= 0, NA_real_, FVC_L),\n    FEV1_FVC = if_else(!is.na(FEV1_FVC) & (FEV1_FVC &lt;= 0 | FEV1_FVC &gt; 1.2), NA_real_, FEV1_FVC)\n  )\n\n\n\n7. Convert FEV1 and FVC to litres and calculate ratio\nThis step applies the NHANES 2014 Hansen reference equations to estimate the Lower Limit of Normal (LLN) for FEV1/FVC, expressed in percent. For each participant:\n\nMales use 74.5 ‚àí 0.12 √ó age\nFemales use 80.2 ‚àí 0.214 √ó age\n\nWe then compare their observed FEV1/FVC ratio (converted to a percentage) against this LLN. The new variable Below_LLN is coded as following:\n\n1= airway obstruction\n0= no airway obstruction\n\nThis binary flag is useful for logistic regression or for summarising the prevalence of obstruction across exposure or demographic groups. We will also use it when running different mixed-models changing the outcome variables.\n\ncleaning &lt;- cleaning %&gt;%\n  mutate(\n    lln_pct_male = 74.5 - 0.12 * age,\n    lln_pct_fem  = 80.2 - 0.214 * age,\n    lln_pct = case_when(\n      sex_clean == \"Male\"   ~ lln_pct_male,\n      sex_clean == \"Female\" ~ lln_pct_fem,\n      TRUE ~ ((74.5 - 0.12 * age) + (80.2 - 0.214 * age)) / 2  # fallback if sex not M/F\n    ),\n    # Convert ratio to percent for comparison, then flag below LLN\n    Below_LLN = as.integer(!is.na(FEV1_FVC) & (FEV1_FVC * 100) &lt; lln_pct)\n  ) %&gt;%\n  select(-lln_pct_male, -lln_pct_fem)\n\n\n\n‚ú® Clean Data: Ready for Analysis\nOnce cleaned, the dataset becomes mixed_clean.txt, with harmonised categories, derived lung function metrics, and an approximate lower limit of normal (LLN) for FEV1/FVC. This version can be used for teaching model fitting, random effects, and basic interpretation of respiratory epidemiology results.\n\nlibrary(knitr)\nclean &lt;- read.table(\"data/mixed_clean.txt\", header = TRUE, sep = \"\\t\")\n\nkable(head(clean, 10))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nid\nsite\nage\nsex\nheight_cm\nweight_kg\nBMI\nsmoking_status\npack_years\neducation\njob\nexposure_cat\nFEV1_mL\nFVC_mL\nsex_clean\nsmoking_status_clean\neducation_clean\njob_lc\njob_clean\nexposure_cat_clean\nFEV1_L\nFVC_L\nFEV1_FVC\nlln_pct\nBelow_LLN\n\n\n\n\n1\nUK\n77\nmale\n181.5\n97.9\n29.7\nOccasional\n11.0\ntertiary\nbartender\nLOW\n3469\n4918\nMale\nCurrent\nTertiary\nbartender\nbartender\nlow_exposure\n3.469\n4.918\n0.7053680\n65.260\n0\n\n\n2\nVietnam\n22\nm\n157.2\n62.6\n25.3\nCURRENT\n15.2\nBSc\nporter\nLOW\n4360\n5107\nMale\nCurrent\nTertiary\nporter\nporter\nlow_exposure\n4.360\n5.107\n0.8537302\n71.860\n0\n\n\n3\nPoland\n45\nM\n146.3\n48.3\n22.6\n\n0.0\nprimary\nfactory\nhigh_exposure\n3154\n4898\nMale\nNA\nPrimary\nfactory\nfactory worker\nhigh_exposure\n3.154\n4.898\n0.6439363\n69.100\n1\n\n\n4\nIndia\n49\nFemale\n149.1\n62.2\n28.0\ncurrent\n6.7\nSecondary\nfactory\nhigh_exposure\n1876\n3283\nFemale\nCurrent\nSecondary\nfactory\nfactory worker\nhigh_exposure\n1.876\n3.283\n0.5714286\n69.714\n1\n\n\n5\nIndia\n72\nm\n177.8\n67.7\n21.4\nquit&lt;1y\n0.0\n\nsecurity\nhi\n3002\n5338\nMale\nFormer\nNone\nsecurity\nsecurity\nlow_exposure\n3.002\n5.338\n0.5623829\n65.860\n1\n\n\n6\nVietnam\n26\nother\n160.4\n78.8\n30.6\nSmokes socially\n6.9\nCollege\ndoctor\nlow\n3010\n3888\nOther\nCurrent\nTertiary\ndoctor\ndoctor\nlow_exposure\n3.010\n3.888\n0.7741770\n73.008\n0\n\n\n7\nUK\n47\nmale\n165.2\n63.8\n23.4\nNEVER\n0.0\nhigh school\nnurse\nlow\n4029\n5274\nMale\nNever\nSecondary\nnurse\nnurse\nlow_exposure\n4.029\n5.274\n0.7639363\n68.860\n0\n\n\n8\nPoland\n28\nFEMALE\n185.8\n100.2\n29.0\nNone\n0.0\nCollege\nwelder\nhigh_exposure\n3644\n5218\nFemale\nNA\nTertiary\nwelder\nwelder\nhigh_exposure\n3.644\n5.218\n0.6983519\n74.208\n1\n\n\n9\nUSA\n71\nF\n184.4\n88.1\n25.9\nquit&lt;1y\n13.1\nPrimary\ncleaner\nlow\n2750\n3922\nFemale\nFormer\nPrimary\ncleaner\ncleaner\nlow_exposure\n2.750\n3.922\n0.7011729\n65.006\n0\n\n\n10\nUK\n60\nF\n172.2\n79.0\n26.6\nNEVER\n0.0\ncollege\nmechanic\nhigh_exposure\n2226\n3583\nFemale\nNever\nTertiary\nmechanic\nmechanic\nhigh_exposure\n2.226\n3.583\n0.6212671\n67.360\n1\n\n\n\n\n\n```\n\n\nFinal variables in the Clean Dataset\n\n\n\n\n\n\n\nVariable\nDescription\n\n\n\n\nid\nUnique participant identifier.\n\n\nsite\nStudy site (country); use as random intercept.\n\n\nage\nAge in years (numeric, cleaned).\n\n\nsex\nStandardised sex: Male, Female, or Other.\n\n\nheight_cm\nHeight in centimetres (numeric, cleaned).\n\n\nweight_kg\nWeight in kilograms (numeric, cleaned).\n\n\nBMI\nBody mass index derived from height and weight.\n\n\nsmoking_status\nRecoded smoking category: Never, Former, Current, Occasional (or NA).\n\n\npack_years\nNumeric smoking exposure (may be 0 for never smokers, NA if unknown).\n\n\neducation\nCleaned education level: None, Primary, Secondary, Tertiary.\n\n\njob\nOriginal reported occupation (as entered).\n\n\njob_clean\nStandardised occupation label (e.g., miner, office worker).\n\n\nexposure_cat\nOriginal exposure category from the raw file (left for reference).\n\n\nexposure_cat_clean\nClean binary exposure category: low_exposure or high_exposure based on job_clean.\n\n\nFEV1_mL\nFEV1 in millilitres (numeric, cleaned).\n\n\nFVC_mL\nFVC in millilitres (numeric, cleaned).\n\n\nFEV1_L\nFEV1 converted to litres.\n\n\nFVC_L\nFVC converted to litres.\n\n\nFEV1_FVC\nRatio FEV1/FVC (unitless).\n\n\nLLN_FEV1FVC_approx\nAge/sex‚Äìadjusted approximate LLN for FEV1/FVC (NHANES-inspired, for teaching).\n\n\nBelow_LLN\nIndicator of obstruction: 1 = FEV1/FVC below LLN, 0 = otherwise."
  }
]